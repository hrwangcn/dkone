<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    #board {
      margin:5%;
      height:400px;width:400px;
      background-color:white;
      opacity:0.5;
    }
    .cell {
			margin:1px;border:4px;
			border-radius:5px;
			border-style:solid;border-color:gray;
      height:90px;width:90px;
      background-color:none;
      float:left;
    }
  </style>
  <script src="main.js"></script>
  <script type="text/javascript">
    var arr = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];
    window.onload=function(){
      const divMatrix = createDivMatrix(4, 4);
      document.body.appendChild(divMatrix);
			//红子先手1,绿子后手-1
			var usr = 1; 
			//棋盘数组，用于计算消子
			var board = document.getElementById("board");
			//添加监听，对元素上色
			board.addEventListener("click",e=>{
				var target = e.target;
				if(target.id!="board"){ //确认是否点击了格子
          //数组更新
          let i = target.id.substring(4,5);
          let j = target.id.substring(6,7);
          if(arr[i][j]===0){ //判断是否可以落子
            arr[i][j] = usr;
            //更新前端页面
            fillElement(target,usr);
            /** 运算消子 **/
            //消行
            let vectorRow = getArrayRow(arr,i);
            checkWin(vectorRow,usr);
            vectorRow = calcBoard(vectorRow,usr);
            setArrayRow(arr,vectorRow,i);
            //消列
            let vectorCol = getArrayColumn(arr,j);
            checkWin(vectorCol,usr);
            vectorCol = calcBoard(vectorCol,usr);
            setArrayColumn(arr,vectorCol,j);
            /** 静等200ms将运算后的矩阵投射到前台 **/
            setTimeout(function(){
              /** 矩阵投射前台 **/
              mapMaxtri();
            },200);
            /** 切换对手 **/
            usr *= -1;
            let player_block = document.querySelector("#player_block");
            if(usr == -1)
              player_block.style.backgroundColor = "cyan";
            else
              player_block.style.backgroundColor = "red";
          }else{
            console.log("已被占用");
          }
				}
				console.log(target.id);
      });
    }
    
    //实现元素上色
    function fillElement(element,usr){
			if(usr===1){
				element.style="background-color:red";
			}else if(usr===-1){
				element.style="background-color:cyan";
			}else{
        element.style="background-color:none";
			}
    }
    
    //根据长度创建矩阵
    function createDivMatrix(rows, cols) {
      const matrix = document.createElement("div");
      matrix.id = "board";
      for (let i = 0; i < rows; i++) {
        for (let j = 0; j < cols; j++) {
          const div = document.createElement("div");
          div.id = `div-${i}-${j}`;
          div.className = "cell";
          matrix.appendChild(div);
        }
      }
      return matrix;
    }

    //投射数组矩阵到div矩阵
    function mapMaxtri(){
      for(let i = 0;i<4;i++){
        for(let j = 0;j<4;j++){
          let id = `#div-${i}-${j}`;
          let div = document.querySelector(id);
          fillElement(div,arr[i][j]);
        }
      }
    }
    
    //
  </script>
</head>
<body style="background-color:none">
<div style="margin:5%;height:100px;width:400px;background-color:#EFEFEF;">
<div style="margin-left:20%;width:90px;height:90px;float:left;background-color:none;font-color:black;line-height:90px">当前执手</div>
<div style="margin-top:7%;width:50px;height:50px;float:left;background-color:red;border-radius:5px;opacity:0.5" id="player_block"></div>
</div>
</body>
</html>
